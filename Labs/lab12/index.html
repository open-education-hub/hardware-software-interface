<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-Labs/lab12">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.1.0">
<title data-rh="true">Lab 12 - Linking | Hardware Software Interface</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="http://localhost//hardware-software-interface/Labs/lab12"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Lab 12 - Linking | Hardware Software Interface"><meta data-rh="true" name="description" content="Task: Linking a Single File"><meta data-rh="true" property="og:description" content="Task: Linking a Single File"><link data-rh="true" rel="canonical" href="http://localhost//hardware-software-interface/Labs/lab12"><link data-rh="true" rel="alternate" href="http://localhost//hardware-software-interface/Labs/lab12" hreflang="en"><link data-rh="true" rel="alternate" href="http://localhost//hardware-software-interface/Labs/lab12" hreflang="x-default"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css" integrity="sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM" crossorigin="anonymous"><link rel="stylesheet" href="/hardware-software-interface/assets/css/styles.a69a9d41.css">
<link rel="preload" href="/hardware-software-interface/assets/js/runtime~main.dfa37bb3.js" as="script">
<link rel="preload" href="/hardware-software-interface/assets/js/main.5804b916.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="theme.common.skipToMainContent"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/hardware-software-interface/"><div class="navbar__logo"><img src="/hardware-software-interface/img/logo.svg" alt="Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/hardware-software-interface/img/logo.svg" alt="Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Hardware Software Interface</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/hardware-software-interface/Labs">Labs</a></div><div class="navbar__items navbar__items--right"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/hardware-software-interface/">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/hardware-software-interface/Labs/">Labs</a><button aria-label="Toggle the collapsible sidebar category &#x27;Labs&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/hardware-software-interface/Labs/lab1">Lab 1 - Number Representation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/hardware-software-interface/Labs/lab2">Lab 2 - Memory Operations. Introduction to GDB</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/hardware-software-interface/Labs/lab4">Lab 4 - Toolchain. GOTO</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/hardware-software-interface/Labs/lab5">Lab 5 - Introduction to Assembly Language</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/hardware-software-interface/Labs/lab6">Lab 6 - Registers and Memory Addressing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/hardware-software-interface/Labs/lab7">Lab 7 - Structures, Vectors and Strings</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/hardware-software-interface/Labs/lab8">Lab 8 - The Stack</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/hardware-software-interface/Labs/lab9">Lab 9 - Functions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/hardware-software-interface/Labs/lab10">Lab 10 - The C - Assembly Interaction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/hardware-software-interface/Labs/lab11">Lab 11 - Buffer Management. Buffer Overflow</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/hardware-software-interface/Labs/lab12">Lab 12 - Linking</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/hardware-software-interface/Labs/lab13">Lab 13 - CTF</a></li></ul></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/hardware-software-interface/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/hardware-software-interface/Labs/"><span itemprop="name">Labs</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Lab 12 - Linking</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Lab 12 - Linking</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="task-linking-a-single-file">Task: Linking a Single File<a class="hash-link" href="#task-linking-a-single-file" title="Direct link to heading">​</a></h2><p>Access the directory <code>drills/tasks/single-link/support/example/</code>.
We want to follow the linking commands for a single C source file.
The source file is <code>hello.c</code>.</p><p>In the three subdirectories, you will find support files for the following scenarios:</p><ul><li><code>a-dynamic/</code>: creating a dynamic executable file</li><li><code>b-static/</code>: creating a static executable file</li><li><code>c-standalone/</code>: creating a standalone executable file without the standard C library</li></ul><p>In each subdirectory, we use the <code>make</code> command to compile the executable file <code>hello</code>.
We use the command <code>file hello</code> to check whether the file is compiled dynamically or statically.</p><p>In the <code>Makefile</code> files, the linking command uses <code>gcc</code>.
An equivalent command that directly uses <code>ld</code> is commented out.
To track the direct usage of <code>ld</code>, we can comment out the <code>gcc</code> command and uncomment the <code>ld</code> command.</p><p>In the case of <code>c-standalone/</code>, since we are not using the standard C library or C runtime library, we need to replace their functionalities.
The functionalities are replaced in the <code>start.asm</code> and <code>puts.asm</code> files.
These files implement the <code>_start</code> function/symbol and the <code>puts</code> function, respectively.
The <code>_start</code> function/symbol is, by default, the entry point of an executable program.
The <code>_start</code> function is responsible for calling the <code>main</code> function and terminating the program.
Because there is no standard library, these two files are written in assembly language and use system calls.</p><p><strong>Bonus</strong>: Add a command in the <code>Makefile</code> in the <code>c-standalone/</code> directory that explicitly uses <code>ld</code> for linking.</p><p>Access the directory <code>drills/tasks/single-link/support/diy/</code>.
We want to compile and link the source files in each subdirectory, following the model of the previous exercise.</p><p>Copy the <code>Makefile</code> files and update them in each subdirectory to obtain the executable file.</p><p>If you&#x27;re having difficulties solving this exercise, go through <a href="/hardware-software-interface/Labs/lab12#linking">this</a> reading material.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="task-linking-multiple-files">Task: Linking Multiple Files<a class="hash-link" href="#task-linking-multiple-files" title="Direct link to heading">​</a></h2><p>Access the directory <code>drills/tasks/multiple-link/support/example/</code>.
We want to follow the linking commands from multiple C source files: <code>main.c</code>, <code>add.c</code>, <code>sub.c</code>.</p><p>As in the previous exercises, there are three subdirectories for three different scenarios:</p><ul><li><code>a-no-header/</code>: external function declarations are made directly in the C source file (<code>main.c</code>)</li><li><code>b-header/</code>: external function declarations are made in a separate header file (<code>ops.h</code>)</li><li><code>c-lib/</code>: external function declarations are made in a separate header file, and linking is done using a static library</li></ul><p>In each subdirectory, we use the <code>make</code> command to compile the executable file <code>main</code>.</p><p>Access the directory <code>drills/tasks/multiple-link/support/diy/</code>.
We want to compile and link the source files in each subdirectory, following the model of the previous exercise.</p><p>Copy the <code>Makefile</code> files and update them in each subdirectory to obtain the executable file.</p><p>If you&#x27;re having difficulties solving this exercise, go through <a href="/hardware-software-interface/Labs/lab12#linking">this</a> reading material.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="task-fixing-the-entry-point-1">Task: Fixing the Entry Point 1<a class="hash-link" href="#task-fixing-the-entry-point-1" title="Direct link to heading">​</a></h2><p>Access the directory <code>drills/tasks/entry-fix-1/support/</code>.
We want to track issues with defining the <code>main()</code> function.</p><p>Go to the subdirectory <code>a-c/</code>.
Run the <code>make</code> command, interpret the encountered error, and resolve it by editing the <code>hello.c</code> file.</p><p>Go to the subdirectory <code>b-asm/</code>.
Run the <code>make</code> command, interpret the encountered error, and resolve it by editing the <code>hello.asm</code> file.</p><p><strong>Bonus</strong>: In the subdirectories <code>c-extra-nolibc/</code> and <code>d-extra-libc/</code>, find solutions that do not modify the source code of <code>hello.c</code>.
These solutions instead modify the build system to use a different function, other than <code>main()</code>, as the program&#x27;s entry point.</p><p>If you&#x27;re having difficulties solving this exercise, go through <a href="/hardware-software-interface/Labs/lab12#linking">this</a> reading material.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="task-fixing-the-entry-point">Task: Fixing the Entry Point<a class="hash-link" href="#task-fixing-the-entry-point" title="Direct link to heading">​</a></h2><p>Access the directory <code>drills/tasks/entry-fix-2/support/</code>.
Run the <code>make</code> command, interpret the encountered error, and resolve it by editing the <code>hello.c</code> file.</p><p>If you&#x27;re having difficulties solving this exercise, go through <a href="/hardware-software-interface/Labs/lab12#linking">this</a> reading material.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="task-warning-not-an-error">Task: Warning (not an error)<a class="hash-link" href="#task-warning-not-an-error" title="Direct link to heading">​</a></h2><p>Access the directory <code>drills/tasks/include-fix/support/</code>.
Run the <code>make</code> command.
A warning appears, but it is from the preprocessing/compilation process.
Resolve this warning by editing the <code>hello.c</code> file.</p><p><strong>Bonus</strong>: Fix the warning without using the <code>#include</code> directive.</p><p>If you&#x27;re having difficulties solving this exercise, go through <a href="/hardware-software-interface/Labs/lab12#linking">this</a> reading material.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="task-fixing-export-issues">Task: Fixing Export Issues<a class="hash-link" href="#task-fixing-export-issues" title="Direct link to heading">​</a></h2><p>Access the directory <code>drills/tasks/export-fix/support/</code>.
Each subdirectory (<code>a-func/</code>, <code>b-var/</code>, <code>c-var-2/</code>) contains a problem related to the export of symbols (functions or variables).
In each subdirectory, run the <code>make</code> command, identify the issue, and edit the necessary files to resolve it.</p><p>If you&#x27;re having difficulties solving this exercise, go through <a href="/hardware-software-interface/Labs/lab12#linking">this</a> reading material.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="task-using-symbols-variables-and-functions">Task: Using Symbols (Variables and Functions)<a class="hash-link" href="#task-using-symbols-variables-and-functions" title="Direct link to heading">​</a></h2><p>Access the directory <code>drills/tasks/10-var-func-fix/support/</code>.
Run the <code>make</code> command, interpret the encountered error, and resolve it by editing the source files.</p><p>If you&#x27;re having difficulties solving this exercise, go through <a href="/hardware-software-interface/Labs/lab12#linking">this</a> reading material.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="task-fixing-library-issues">Task: Fixing Library Issues<a class="hash-link" href="#task-fixing-library-issues" title="Direct link to heading">​</a></h2><p>Access the directory <code>drills/tasks/lib-fix/support/</code>.
Run the <code>make</code> command, interpret the encountered error, and resolve it by editing the <code>Makefile</code>.
Refer to the <code>Makefile</code> in the directory <code>drills/tasks/multiple-link/support/example/c-lib/</code>.</p><p>If you&#x27;re having difficulties solving this exercise, go through <a href="/hardware-software-interface/Labs/lab12#linking">this</a> reading material.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="task-linking-an-object-file-without-source-code">Task: Linking an Object File (without Source Code)<a class="hash-link" href="#task-linking-an-object-file-without-source-code" title="Direct link to heading">​</a></h2><p>Access the directory <code>drills/tasks/obj-link-dev/support/</code>.
The file <code>shop.o</code> exposes an interface (functions and variables) that allows displaying messages.
Edit the <code>main.c</code> file to properly call the exposed interface and display the messages:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">price is </span><span class="token number" style="color:#36acaa">21</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">quantity is </span><span class="token number" style="color:#36acaa">42</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Explore the interface and the content of the functions in the <code>shop.o</code> file using <code>nm</code> and <code>objdump</code>.</p><p>If you&#x27;re having difficulties solving this exercise, go through <a href="/hardware-software-interface/Labs/lab12#linking">this</a> reading material.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="linking">Linking<a class="hash-link" href="#linking" title="Direct link to heading">​</a></h2><p>Linking is the final phase of the building process.
Linking combines multiple object files into an executable file.</p><p>To obtain an executable file from object files, the linker performs the following actions:</p><ol><li>Symbol resolution: locating the undefined symbols of one object file in other object files.</li><li>Section merging: merging sections of the same type from different object files into a single section in the executable file.</li><li>Address binding: after merging, the effective address symbols within the executable file can be established.</li><li>Symbol relocation: once the symbol addresses are set, the instructions and data referring to those addresses in the executable must be updated.</li><li>Entry point establishment: specifying the address of the first instruction to be executed.</li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="linker-invocation">Linker Invocation<a class="hash-link" href="#linker-invocation" title="Direct link to heading">​</a></h3><p>The linker is generally invoked by the compilation utility (<code>gcc</code>, <code>clang</code>, <code>cl</code>).
Thus, invoking the linker is transparent to the user.
In specific cases, such as creating a kernel image or images for embedded systems, the user will invoke the linker directly.</p><p>If we have a source C file <code>app.c</code>, we will use the compiler to obtain the object file <code>app.o</code>:</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">gcc -c -o app.o app.c</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Then, to obtain the executable file <code>app</code> from the object file <code>app.o</code>, we use the <code>gcc</code> utility again:</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">gcc -o app app.o</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In the background, <code>gcc</code> will invoke the linker and build the executable <code>app</code>.
The linker will also link against the standard C library (libc).</p><p>The linking process will work only if the file <code>app.c</code> has the <code>main()</code> function defined, which is the main function of the program.
Linked files must have a single <code>main()</code> function in order to produce an executable.</p><p>If we have multiple C source files, we invoke the compiler for each file and then the linker:</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">gcc -c -o helpers.o helpers.c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcc -c -o app.o app.c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcc -o app app.o helpers.o</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The last command is the linking command, which links the object files <code>app.o</code> and <code>helpers.o</code> into the executable file <code>app</code>.</p><p>In the case of C++ source files, we will use the <code>g++</code> command:</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">g++ -c -o helpers.o helpers.cpp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">g++ -c -o app.o app.cpp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">g++ -o app app.o helpers.o</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>We can also use the <code>gcc</code> command for linking, specifying linking with the standard C++ library (libc++):</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">gcc -o app app.o helpers.o -lstdc++</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The Linux linking utility, <code>ld</code>, is invoked transparently by <code>gcc</code> or <code>g++</code>.
To see how the linker is invoked, we use the <code>-v</code> option of the <code>gcc</code> utility, with the following output:</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/usr/lib/gcc/x86_64-linux-gnu/7/collect2 -plugin /usr/lib/gcc/x86_64-linux-gnu/7/liblto_plugin.so</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-plugin-opt=/usr/lib/gcc/x86_64-linux-gnu/7/lto-wrapper -plugin-opt=-fresolution=/tmp/ccwnf5NM.res</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-plugin-opt=-pass-through=-lgcc -plugin-opt=-pass-through=-lgcc_s -plugin-opt=-pass-through=-lc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-plugin-opt=-pass-through=-lgcc -plugin-opt=-pass-through=-lgcc_s --build-id --eh-frame-hdr -m elf_i386 --hash-style=gnu</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--as-needed -dynamic-linker /lib/ld-linux.so.2 -z relro -o hello</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/usr/lib/gcc/x86_64-linux-gnu/7/../../../i386-linux-gnu/crt1.o</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/usr/lib/gcc/x86_64-linux-gnu/7/../../../i386-linux-gnu/crti.o /usr/lib/gcc/x86_64-linux-gnu/7/32/crtbegin.o</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-L/usr/lib/gcc/x86_64-linux-gnu/7/32 -L/usr/lib/gcc/x86_64-linux-gnu/7/../../../i386-linux-gnu</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-L/usr/lib/gcc/x86_64-linux-gnu/7/../../../../lib32 -L/lib/i386-linux-gnu -L/lib/../lib32 -L/usr/lib/i386-linux-gnu</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-L/usr/lib/../lib32 -L/usr/lib/gcc/x86_64-linux-gnu/7 -L/usr/lib/gcc/x86_64-linux-gnu/7/../../../i386-linux-gnu</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-L/usr/lib/gcc/x86_64-linux-gnu/7/../../.. -L/lib/i386-linux-gnu -L/usr/lib/i386-linux-gnu hello.o -lgcc --push-state</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--as-needed -lgcc_s --pop-state -lc -lgcc --push-state --as-needed -lgcc_s --pop-state</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/usr/lib/gcc/x86_64-linux-gnu/7/32/crtend.o /usr/lib/gcc/x86_64-linux-gnu/7/../../../i386-linux-gnu/crtn.o</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">COLLECT_GCC_OPTIONS=&#x27;-no-pie&#x27; &#x27;-m32&#x27; &#x27;-v&#x27; &#x27;-o&#x27; &#x27;hello&#x27; &#x27;-mtune=generic&#x27; &#x27;-march=i686&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The <code>collect2</code> utility is, in fact, a wrapper around the <code>ld</code> utility.
The result of running the command is complex. A &quot;manual&quot; invocation of the <code>ld</code> command would look like this:</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ld -dynamic-linker /lib/ld-linux.so.2 -m elf_i386 -o app /usr/lib32/crt1.o /usr/lib32/crti.o app.o helpers.o -lc /usr/lib32/crtn.o</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The arguments of the above command have the following meanings:</p><ul><li><code>-dynamic-linker /lib/ld-linux.so.2</code>: specifies the dynamic loader/linker used for loading the dynamic executable</li><li><code>-m elf_i386</code>: links files for the x86 architecture (32-bit, i386)</li><li><code>/usr/lib32/crt1.o</code>, <code>/usr/lib32/crti.o</code>, <code>/usr/lib32/crtn.o</code>: represent the C runtime library (<code>crt</code> - <em>C runtime</em>) that provides the necessary support for loading the executable</li><li><code>-lc</code>: links against standard C library (libc)</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="file-inspection">File Inspection<a class="hash-link" href="#file-inspection" title="Direct link to heading">​</a></h3><p>To track the linking process, we use static analysis utilities such as <code>nm</code>, <code>objdump</code>, and <code>readelf</code>.</p><p>We use the <code>nm</code> utility to display symbols from an object file or an executable file:</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ nm hello.o</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">00000000 T main</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         U puts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ nm hello</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0804a01c B __bss_start</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0804a01c b completed.7283</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0804a014 D __data_start</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0804a014 W data_start</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">08048370 t deregister_tm_clones</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">08048350 T _dl_relocate_static_pie</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">080483f0 t __do_global_dtors_aux</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">08049f10 t __do_global_dtors_aux_fini_array_entry</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0804a018 D __dso_handle</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">08049f14 d _DYNAMIC</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0804a01c D _edata</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0804a020 B _end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">080484c4 T _fini</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">080484d8 R _fp_hw</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">08048420 t frame_dummy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">08049f0c t __frame_dummy_init_array_entry</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0804861c r __FRAME_END__</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0804a000 d _GLOBAL_OFFSET_TABLE_</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         w __gmon_start__</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">080484f0 r __GNU_EH_FRAME_HDR</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">080482a8 T _init</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">08049f10 t __init_array_end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">08049f0c t __init_array_start</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">080484dc R _IO_stdin_used</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">080484c0 T __libc_csu_fini</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">08048460 T __libc_csu_init</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         U __libc_start_main@@GLIBC_2.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">08048426 T main</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         U puts@@GLIBC_2.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">080483b0 t register_tm_clones</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">08048310 T _start</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0804a01c D __TMC_END__</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">08048360 T __x86.get_pc_thunk.bx</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The <code>nm</code> command displays three columns:</p><ul><li>the symbol&#x27;s address</li><li>the section and type where the symbol is located</li><li>the symbol&#x27;s name</li></ul><p>A symbol is the name of a global variable or function.
It is used by the linker to make connections between different object modules.
Symbols are not necessary for executables, which is why executables can be stripped.</p><p>The symbol&#x27;s address is actually the offset within a section for object files and is the effective address for executables.</p><p>The second column specifies the section and type of the symbol.
If it is uppercase, then the symbol is exported and can be used by another module.
If it is lowercase, then the symbol is not exported and is local to the object module, making it unusable in other modules.
Thus:</p><ul><li><code>d</code>: the symbol is in the initialized data area (<code>.data</code>), unexported</li><li><code>D</code>: the symbol is in the initialized data area (<code>.data</code>), exported</li><li><code>t</code>: the symbol is in the code area (<code>.text</code>), unexported</li><li><code>T</code>: the symbol is in the code area (<code>.text</code>), exported</li><li><code>r</code>: the symbol is in the read-only data area (<code>.rodata</code>), unexported</li><li><code>R</code>: the symbol is in the read-only data area (<code>.rodata</code>), exported</li><li><code>b</code>: the symbol is in the uninitialized data area (<code>.bss</code>), unexported</li><li><code>B</code>: the symbol is in the uninitialized data area (<code>.bss</code>), exported</li><li><code>U</code>: the symbol is undefined (it is used in the current module but defined in another module)</li></ul><p>More information can be found in the manual page for the <code>nm</code> utility.</p><p>Using the <code>objdump</code> command, we can disassemble the code of object files and executables.
This way, we can see the assembly code and how the modules operate.</p><p>The <code>readelf</code> command is used to inspect object or executable files.
With the <code>readelf</code> command, we can view the headers of files.
An important piece of information in the header of executable files is the entry point, the address of the first instruction executed:</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ readelf -h hello</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ELF Header:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Magic:   7f 45 4c 46 01 01 01 00 00 00 00 00 00 00 00 00</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Class:                             ELF32</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Data:                              2&#x27;s complement, little endian</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Version:                           1 (current)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  OS/ABI:                            UNIX - System V</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ABI Version:                       0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Type:                              EXEC (Executable file)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Machine:                           Intel 80386</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Version:                           0x1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Entry point address:               0x8048310</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Start of program headers:          52 (bytes into file)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Start of section headers:          8076 (bytes into file)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Flags:                             0x0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Size of this header:               52 (bytes)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Size of program headers:           32 (bytes)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Number of program headers:         9</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Size of section headers:           40 (bytes)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Number of section headers:         35</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Section header string table index: 34</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Using the <code>readelf</code> command, we can see the sections of an executable/object file:</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ readelf -S hello</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">There are 35 section headers, starting at offset 0x1f8c:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Section Headers:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [Nr] Name              Type            Addr     Off    Size   ES Flg Lk Inf Al</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [ 0]                   NULL            00000000 000000 000000 00      0   0  0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [ 1] .interp           PROGBITS        08048154 000154 000013 00   A  0   0  1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [ 2] .note.ABI-tag     NOTE            08048168 000168 000020 00   A  0   0  4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [ 3] .note.gnu.build-i NOTE            08048188 000188 000024 00   A  0   0  4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[...]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Also, with the <code>readelf</code> command, we can list (dump) the contents of a specific section:</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ readelf -x .rodata hello</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Hex dump of section &#x27;.rodata&#x27;:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  0x080484d8 03000000 01000200 48656c6c 6f2c2057 ........Hello, W</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  0x080484e8 6f726c64 2100                       orld!.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="guide-linking-c-and-c">Guide: Linking C and C++<a class="hash-link" href="#guide-linking-c-and-c" title="Direct link to heading">​</a></h2><p>Access the directory <code>drills/tasks/cpp-obs/support/</code>.
We want to observe how linking is performed with mixed sources: C and C++.</p><p>In the <code>bad/</code> subdirectory, we have two directories, <code>c-calls-cpp/</code> and <code>cpp-calls-c/</code>, where we combine C and C++ sources.
In both cases, using <code>make</code> displays errors.
This occurs because C++ symbols are <em>mangled</em>.</p><p>If we use the <code>nm</code> command on object modules obtained from C source code, we get:</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ nm add.o</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0000000000000000 T _Z3addii</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ nm sub.o</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0000000000000000 T _Z3subii</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The symbol names are not <code>add</code> and <code>sub</code>, but rather <code>_Z3addii</code> and <code>_Z3subii</code>.
C++ symbol names are <em>mangled</em> and define the function signature.
This allows for functions with the same name but different signatures.
Details about <em>name mangling</em> can be found <a href="https://en.wikipedia.org/wiki/Name_mangling" target="_blank" rel="noopener noreferrer">here</a>.</p><p>To resolve this, symbols defined in C and imported into C++, or vice versa, must be prefixed with the directive <code>extern &quot;C&quot;</code>.
This way, the C++ compiler will use simple names for the imported/exported symbols, allowing them to be used together with C modules.
This is implemented in the <code>good/</code> subdirectory.
Details about the <code>extern &quot;C&quot;</code> directive can be found <a href="https://stackoverflow.com/a/1041880/4804196" target="_blank" rel="noopener noreferrer">here</a>.</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/hardware-software-interface/Labs/lab11"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Lab 11 - Buffer Management. Buffer Overflow</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/hardware-software-interface/Labs/lab13"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Lab 13 - CTF</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#task-linking-a-single-file" class="table-of-contents__link toc-highlight">Task: Linking a Single File</a></li><li><a href="#task-linking-multiple-files" class="table-of-contents__link toc-highlight">Task: Linking Multiple Files</a></li><li><a href="#task-fixing-the-entry-point-1" class="table-of-contents__link toc-highlight">Task: Fixing the Entry Point 1</a></li><li><a href="#task-fixing-the-entry-point" class="table-of-contents__link toc-highlight">Task: Fixing the Entry Point</a></li><li><a href="#task-warning-not-an-error" class="table-of-contents__link toc-highlight">Task: Warning (not an error)</a></li><li><a href="#task-fixing-export-issues" class="table-of-contents__link toc-highlight">Task: Fixing Export Issues</a></li><li><a href="#task-using-symbols-variables-and-functions" class="table-of-contents__link toc-highlight">Task: Using Symbols (Variables and Functions)</a></li><li><a href="#task-fixing-library-issues" class="table-of-contents__link toc-highlight">Task: Fixing Library Issues</a></li><li><a href="#task-linking-an-object-file-without-source-code" class="table-of-contents__link toc-highlight">Task: Linking an Object File (without Source Code)</a></li><li><a href="#linking" class="table-of-contents__link toc-highlight">Linking</a><ul><li><a href="#linker-invocation" class="table-of-contents__link toc-highlight">Linker Invocation</a></li><li><a href="#file-inspection" class="table-of-contents__link toc-highlight">File Inspection</a></li></ul></li><li><a href="#guide-linking-c-and-c" class="table-of-contents__link toc-highlight">Guide: Linking C and C++</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://curs.upb.ro" target="_blank" rel="noopener noreferrer" class="footer__link-item">Main site<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://ocw.cs.pub.ro/courses/pclp2" target="_blank" rel="noopener noreferrer" class="footer__link-item">OCW<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.facebook.com/10c1a" target="_blank" rel="noopener noreferrer" class="footer__link-item">Facebook<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 OpenEdu Team</div></div></div></footer></div>
<script src="/hardware-software-interface/assets/js/runtime~main.dfa37bb3.js"></script>
<script src="/hardware-software-interface/assets/js/main.5804b916.js"></script>
</body>
</html>