<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-Labs/lab8">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.1.0">
<title data-rh="true">Lab 8 - The Stack | Hardware Software Interface</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="http://localhost//hardware-software-interface/Labs/lab8"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Lab 8 - The Stack | Hardware Software Interface"><meta data-rh="true" name="description" content="Task: Max"><meta data-rh="true" property="og:description" content="Task: Max"><link data-rh="true" rel="canonical" href="http://localhost//hardware-software-interface/Labs/lab8"><link data-rh="true" rel="alternate" href="http://localhost//hardware-software-interface/Labs/lab8" hreflang="en"><link data-rh="true" rel="alternate" href="http://localhost//hardware-software-interface/Labs/lab8" hreflang="x-default"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css" integrity="sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM" crossorigin="anonymous"><link rel="stylesheet" href="/hardware-software-interface/assets/css/styles.a69a9d41.css">
<link rel="preload" href="/hardware-software-interface/assets/js/runtime~main.dfa37bb3.js" as="script">
<link rel="preload" href="/hardware-software-interface/assets/js/main.5804b916.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="theme.common.skipToMainContent"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/hardware-software-interface/"><div class="navbar__logo"><img src="/hardware-software-interface/img/logo.svg" alt="Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/hardware-software-interface/img/logo.svg" alt="Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Hardware Software Interface</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/hardware-software-interface/Labs">Labs</a></div><div class="navbar__items navbar__items--right"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/hardware-software-interface/">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/hardware-software-interface/Labs/">Labs</a><button aria-label="Toggle the collapsible sidebar category &#x27;Labs&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/hardware-software-interface/Labs/lab1">Lab 1 - Number Representation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/hardware-software-interface/Labs/lab2">Lab 2 - Memory Operations. Introduction to GDB</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/hardware-software-interface/Labs/lab4">Lab 4 - Toolchain. GOTO</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/hardware-software-interface/Labs/lab5">Lab 5 - Introduction to Assembly Language</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/hardware-software-interface/Labs/lab6">Lab 6 - Registers and Memory Addressing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/hardware-software-interface/Labs/lab7">Lab 7 - Structures, Vectors and Strings</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/hardware-software-interface/Labs/lab8">Lab 8 - The Stack</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/hardware-software-interface/Labs/lab9">Lab 9 - Functions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/hardware-software-interface/Labs/lab10">Lab 10 - The C - Assembly Interaction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/hardware-software-interface/Labs/lab11">Lab 11 - Buffer Management. Buffer Overflow</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/hardware-software-interface/Labs/lab12">Lab 12 - Linking</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/hardware-software-interface/Labs/lab13">Lab 13 - CTF</a></li></ul></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/hardware-software-interface/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/hardware-software-interface/Labs/"><span itemprop="name">Labs</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Lab 8 - The Stack</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Lab 8 - The Stack</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="task-max">Task: Max<a class="hash-link" href="#task-max" title="Direct link to heading">​</a></h2><p>Calculate the maximum between two numbers in two registers (eax and ebx) using a comparison instruction, a jump instruction, and push/pop instructions.</p><blockquote><p><strong>TIP:</strong> Consider how you can swap two registers using the stack.</p></blockquote><p>If you&#x27;re having difficulties solving this exercise, go through <a href="/hardware-software-interface/Labs/lab8#introduction-to-the-stack">this</a> reading material</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="task-reverse-array">Task: Reverse Array<a class="hash-link" href="#task-reverse-array" title="Direct link to heading">​</a></h2><p>Building on the <code>reverse-array.asm</code> exercise, implement the <code>TODO</code>s without using the <code>mov</code> instruction when working with arrays, so that at the end of the program, the <code>output</code> array contains the <code>input</code> array in reverse order.</p><blockquote><p><strong>NOTE:</strong> After a correct solution, the program should print:</p><div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Reversed array</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">911</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">845</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">263</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">242</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">199</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">184</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">122</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></blockquote><p>If you&#x27;re having difficulties solving this exercise, go through <a href="/hardware-software-interface/Labs/lab8#introduction-to-the-stack">this</a> reading material</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="task-stack-addressing">Task: Stack Addressing<a class="hash-link" href="#task-stack-addressing" title="Direct link to heading">​</a></h2><p>The <code>stack-addressing.asm</code> program in the lab&#x27;s archive allocates and initializes two local variables on the stack:</p><ul><li>an array of natural numbers from 1 to <code>NUM</code></li><li>a string &quot;Bob has corn&quot;.</li></ul><ol><li>Replace each <code>push</code> instruction with an equivalent sequence of instructions.</li><li>Print the addresses and values on the stack in the interval <code>[esp, ebp]</code> (from low addresses to high addresses) byte by byte.</li><li>Print the string allocated on the stack byte by byte and explain how it looks in memory.
Think about where you should start displaying and when you should stop.</li><li>Print the vector allocated on the stack element by element.
Think about where you should start displaying and what size each element has.</li></ol><blockquote><p><strong>NOTE:</strong> After a successful implementation, the program should display something similar to the following output (it won&#x27;t be exactly the same, stack memory addresses may differ):</p><div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token number" style="color:#36acaa">0xffcf071b</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">65</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0xffcf071c</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">110</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0xffcf071d</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">97</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0xffcf071e</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">32</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0xffcf071f</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">97</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0xffcf0734</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0xffcf0735</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0xffcf0736</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0xffcf0737</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0xffcf0738</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0xffcf0739</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0xffcf073a</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0xffcf073b</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Bob has corn</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Explain the significance of each byte.
Why are they arranged in that particular order?
Why are some bytes 0?</p><p><strong>TIP:</strong> Remember that ASCII character codes are represented as decimal values.
Remember the order in which the bytes of a larger number are stored: review the section <strong>Order of representation of numbers larger than one byte</strong> from Lab 01.</p></blockquote><p>If you&#x27;re having difficulties solving this exercise, go through <a href="/hardware-software-interface/Labs/lab8#introduction-to-the-stack">this</a> reading material</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="task-local-var">Task: Local Var<a class="hash-link" href="#task-local-var" title="Direct link to heading">​</a></h2><p>The program <code>local-var.asm</code> in the laboratory archive combines two sorted arrays (<code>array_1</code> and <code>array_2</code>) by placing the resulting array in <code>array_output</code> defined in the <code>.data</code> section.</p><p>Modify the program so that <code>array_1</code>, <code>array_2</code>, and <code>array_output</code> are allocated on the stack.
The array allocation is done using the <code>sub</code> instruction.
For the copies of arrays <code>array_1</code> and <code>array_2</code>, you will need to copy their elements from the <code>.data</code> section to the stack before using them.</p><p>If you&#x27;re having difficulties solving this exercise, go through <a href="/hardware-software-interface/Labs/lab8#introduction-to-the-stack">this</a> reading material</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="task-gcd---greatest-common-divisor">Task: GCD - Greatest Common Divisor<a class="hash-link" href="#task-gcd---greatest-common-divisor" title="Direct link to heading">​</a></h2><p>Open <code>gcd.asm</code> and run the program.
The code calculates the greatest common divisor (GCD) of two numbers given as parameters using the <code>eax</code> and <code>edx</code> registers, and then stores the calculated value back in the <code>eax</code> register.</p><ol><li>Make the necessary modifications so that the error message - <code>Segmentation fault (core dumped)</code> - no longer appears.</li><li>Within the <code>print</code> label, display the result in the following format:</li></ol><div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">gcd</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">49</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">28</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">7</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>If you&#x27;re having difficulties solving this exercise, go through <a href="/hardware-software-interface/Labs/lab8#introduction-to-the-stack">this</a> reading material</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="introduction-to-the-stack">Introduction to the Stack<a class="hash-link" href="#introduction-to-the-stack" title="Direct link to heading">​</a></h2><p>In this lab, we will learn about how the stack is represented in assembly language, its utility, and how to it could be useful to us.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="reminder-stack-data-structure">Reminder: Stack Data Structure<a class="hash-link" href="#reminder-stack-data-structure" title="Direct link to heading">​</a></h3><blockquote><p><strong>NOTE:</strong> This is a quick reminder on how the abstract data structure works.
If you feel like you already understand this, you can skip this part.</p></blockquote><p>In the world of algorithms and data structure, a &quot;stack&quot; is a data structure used to hold data, mirroring a real-life stack of objects (for example, a stack of books, or a stack of boxes).
This data structure&#x27;s usefulness comes from optimizing the ease and speed at which elements can be added or removed from the top of the stack.
It forces us to think about how our data is organized relative to the stack&#x27;s base and top.
The usual operations with the stack are:</p><ul><li><code>push</code> - add an element to the top of the stack</li><li><code>pop</code> - get the element from the top of the stack <strong>and remove it</strong></li><li><code>peek</code> or <code>top</code> - get the element from the top of the stack <strong>without removing it</strong></li></ul><p><img loading="lazy" alt="An image showing a stack data structure at different stages. The empty stack gains the element labeled &amp;quot;1&amp;quot; after the instruction &amp;quot;push 1&amp;quot; is applied to it. After the instruction &amp;quot;push 2&amp;quot;, the stack has two items, element 1 being below element 2. Finally, the &amp;quot;pop&amp;quot; instruction makes the stack lose element 2" src="/hardware-software-interface/assets/images/the-stack-bb76234db11c39d83991c27fc25aa0bd.svg" class="img_ev3q"></p><p>As the above image suggests, the order in which items are inserted and removed from a stack is represented by the phrase &quot;first in, last out&quot;.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="so-why-is-it-useful">So, Why is it Useful?<a class="hash-link" href="#so-why-is-it-useful" title="Direct link to heading">​</a></h3><p>In the previous chapters we learned how to work with the basics of assembly.
A pretty big limitation we have imposed on ourselves by using such a low-level language is the small number of values we can work with at a time.
For anything but small programs, having just the 6 registers (<code>eax</code>, <code>ebx</code>, <code>ecx</code>, <code>edx</code>, <code>esi</code>, <code>edi</code>) is usually not enough, and creating global variables for temporary values is not memory efficient and, at some point, we&#x27;ll struggle to even name them something reasonable!</p><p>You might have also felt the absence of functions. The stack will help us out as it provides a nice place to store:</p><ul><li>the arguments,</li><li>the values of registers before entering a function so they can be restored on exit,</li><li>and some metadata useful for when we want to exit out of a function.</li></ul><p>More on this in the next lab.</p><p>As you might have guessed, the solution to this is to use a stack on which we can put arbitrary values onto.
We don&#x27;t need implement it ourselves - it comes built-in 😄!
Whenever a program stars, the kernel makes sure a zone of memory is allocated for the sole purpose of writing arbitrary data onto.
Moreover, CPUs also have some specialized instructions that work directly with this memory in a way similar to how a normal stack works.</p><blockquote><p><strong>Note</strong>: The size of the stack memory area is often <a href="https://stackoverflow.com/questions/54821412/how-to-increase-stack-size-when-compiling-a-c-program-using-mingw-compiler" target="_blank" rel="noopener noreferrer">set at compile-time</a>.
When going over the maximum allocated space, you can receive a Segmentation Fault, and the phenomenon is called a <code>Stack Overflow</code>.
You will have probably received this error when you declare a local array with a very high capacity, or when calling a recursive function which never returns.</p></blockquote><h3 class="anchor anchorWithStickyNavbar_LWe7" id="stack-operations">Stack Operations<a class="hash-link" href="#stack-operations" title="Direct link to heading">​</a></h3><p>The stack can be modified in two ways:</p><ol><li>By using special instructions designed for stack operations, the most common of which are <code>push</code> and <code>pop</code>:</li></ol><div class="language-assembly codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-assembly codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">%include &quot;io.asm&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">section .text</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">global CMAIN</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CMAIN:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mov eax, 7</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mov ebx, 8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    add eax, ebx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    push eax                 ; push the value of the eax register onto the stack</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mov eax, 10              ; we can now use the eax register, as its value is saved on the stack</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    PRINTF32 `%d \n\x0`, eax  ; 10</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pop eax                  ; retrieve the value of the eax register from the stack</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    PRINTF32 `%d \n\x0`, eax  ; 15</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol><li>By directly accessing the memory with the help of a special register in which the top of the stack is held - <code>esp</code> also known as the &quot;stack pointer register&quot;.</li></ol><div class="language-assembly codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-assembly codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">%include &quot;io.asm&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">section .text</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">global CMAIN</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CMAIN:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mov eax, 7</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mov ebx, 8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    add eax, ebx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sub esp, 4           ; reserve 4 bytes on the stack</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mov [esp], eax       ; move the contents of the eax register to the new address pointed to by esp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mov eax, 10</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    PRINTF32 `%d \n\x0`, eax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mov eax, [esp]       ; retrieve the value from the stack</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    add esp, 4           ; restore the value of the esp register</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    PRINTF32 `%d \n\x0`, eax</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p><strong>IMPORTANT:</strong> Comment out the instructions <code>sub esp, 4</code> and <code>add esp, 4</code>.
What happens?
Why?</p><p><strong>NOTE:</strong> The stack is used to remember the return address when a function is called.
<strong>Note that the stack grows from higher addresses to lower addresses.</strong>
This is why memory allocation on the stack is done using the <code>sub</code> instruction, and deallocation is done using the <code>add</code> instruction.</p></blockquote><p><img loading="lazy" alt="stack_image" src="/hardware-software-interface/assets/images/the-stack-growth-5b1bf5b116f559c5646cc74dd64cd802.svg" class="img_ev3q"></p><p>Some processors do not have support for stack operations: for example, MIPS processors do not have <code>push</code> and <code>pop</code> instructions and do not have a special register for the stack pointer.
Thus, if we want to implement stack operations on a MIPS processor, we would do it exactly as in the example above, but we can choose any register to keep track of the stack pointer.</p><p>Therefore, the <code>push eax</code> instruction on an x86 processor is equivalent to:</p><div class="language-assembly codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-assembly codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sub esp, 4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mov [esp], eax</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>And the <code>pop eax</code> is equivalent to:</p><div class="language-assembly codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-assembly codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mov eax, [esp]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">add esp, 4</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p><strong>IMPORTANT:</strong> We need to be careful with the amount of data allocated on the stack because the size of the stack is limited.
Overfilling the stack will lead to the well-known error of <strong>stack overflow</strong> (more in the security lab).</p><p><strong>NOTE:</strong> The default stack size on Linux for a 64-bit architecture is 8MiB.</p></blockquote><h3 class="anchor anchorWithStickyNavbar_LWe7" id="stack-in-the-context-of-a-processs-address-space">Stack in the Context of a Process&#x27;s Address Space<a class="hash-link" href="#stack-in-the-context-of-a-processs-address-space" title="Direct link to heading">​</a></h3><p>A process&#x27;s address space, or more precisely, a process&#x27;s virtual address space, represents the virtual memory area usable by a process.
Each process has its own address space.
Even in situations where two processes share a memory region, the virtual space is distinct, but it maps to the same physical memory region.</p><p><img loading="lazy" alt="stack_image" src="/hardware-software-interface/assets/images/process_address_space-1b6a850e54c7237af3ca9a6b1ae6fe31.jpg" width="253" height="382" class="img_ev3q"></p><p>In the figure above, a typical process&#x27;s address space is presented.</p><p>The four important zones in a process&#x27;s address space are the data zone, the code zone, the stack, and the heap.
As can be observed from the figure, the stack and the heap are the zones that can grow.
In fact, these two zones are dynamic and only make sense in the context of a process.
On the other hand, the information in the data and code zones is described in the executable.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="tricks-and-tips">Tricks and Tips<a class="hash-link" href="#tricks-and-tips" title="Direct link to heading">​</a></h3><ol><li><p>The golden rule of stack usage is: the number of <code>push</code>-es should equal the number of <code>pop</code>-s in a function.
Given that the stack is used for function calls, it is very important that when a function finishes its execution, the stack pointer should be updated so that it points to the same memory location (of the stack) as it did at the time of entering the function.</p></li><li><p>In situations where we perform N <code>push</code>-es and reach the end of the function without doing a <code>pop</code> for any of the values, we can restore the stack pointer using the <code>add</code> instruction.</p></li></ol><div class="language-assembly codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-assembly codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">section .text</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">global CMAIN</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CMAIN:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mov eax, 5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mov ebx, 6</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mov ecx, 7</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    push eax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    push ebx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    push ecx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    add esp, 12     ; equivalent to using 3 consecutive pop-s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ret</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol><li>An alternative method is to save the current stack pointer value in a separate register, such as <code>ebp</code>, before performing any <code>push</code> operations.
This allows us to easily restore the stack pointer value at the end of the function, without having to keep track of the number of <code>push</code> operations performed.</li></ol><div class="language-assembly codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-assembly codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">section .text</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">global CMAIN</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CMAIN:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mov ebp, esp       ; save current stack pointer value in ebp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mov eax, 5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mov ebx, 6</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mov ecx, 7</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    push eax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    push ebx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    push ecx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mov esp, ebp       ; restore stack pointer value</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ret</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p><strong>IMPORTANT:</strong> What is the primary use of the <code>ebp</code> register?</p></blockquote><p>As we can observe, the <code>ebp</code> register defines the stack frame for each function.
Similarly to how we can address local variables using the <code>esp</code> register, we can do the same with <code>ebp</code>.
Additionally, we will see that function parameters are addressed using <code>ebp</code>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="guide-stack-operations">Guide: Stack Operations<a class="hash-link" href="#guide-stack-operations" title="Direct link to heading">​</a></h2><p>The <code>stack_operations.asm</code> file demonstrates various stack operations.
The main focus is to show how to manipulate the stack by pushing and popping values, and how to &quot;allocate&quot; and &quot;deallocate&quot; memory on the stack.</p><blockquote><p><strong>Note:</strong> Notice how <code>push</code> and <code>pop</code> are just syntactic sugar for the simpler <code>sub</code>, <code>add</code>, and <code>mov</code> instructions.</p></blockquote><p>For convenience, here&#x27;s the contents of the file.
To play around with it, download the lab locally.</p><div class="language-assembly codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-assembly codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">%include &quot;printf32.asm&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">section .data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    var: dd ?</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">section .text</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">; esp -&gt; stack pointer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">; ebp -&gt; base pointer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">extern printf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">global main</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">main:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    push ebp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mov ebp, esp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    push dword 10 ; sub esp, 4;  mov [esp], 10;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    push dword 11 ; sub esp, 4;  mov [esp], 11;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    push dword 12 ; sub esp, 4;  mov [esp], 12;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    push dword 13 ; sub esp, 4;  mov [esp], 13;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    push dword 14 ; sub esp, 4;  mov [esp], 13;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pusha  ; push all registers on the stack</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    popa  ; pop all registers from the stack</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ; Version 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pop eax; ; mov eax, [esp]; add esp, 4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pop eax; ; mov eax, [esp]; add esp, 4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pop eax; ; mov eax, [esp]; add esp, 4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pop eax; ; mov eax, [esp]; add esp, 4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pop eax; ; mov eax, [esp]; add esp, 4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ; Version 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ; add esp, 20 ; 4 * number_of_push</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ; Version 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ; mov esp, ebp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ; sub esp &lt;-&gt; add esp -&gt; use to allocate/deallocate memory</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ; Aloc 8 bytes &lt;-&gt; 2 int</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ; sub esp, 8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ; mov [esp], 10</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ; mov [esp + 4], 12</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ; Push/Pop from global variable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mov dword [var], 1337</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    push dword [var]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pop dword [var]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mov eax, [var]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    PRINTF32 `VAR: %d\n\x0`, eax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    leave</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ret</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="guide-stack-addressing">Guide: Stack Addressing<a class="hash-link" href="#guide-stack-addressing" title="Direct link to heading">​</a></h2><p>The <code>stack_addressing.asm</code> file demonstrates how data is stored on the stack, and especially in what order.</p><p>Here&#x27;s what an usual output for the compiled program would be:</p><div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token number" style="color:#36acaa">0xff99fba8</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0xf7f46020</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0xff99fba4</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0xa</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0xff99fba0</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0xb</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0xff99fb9c</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0xc</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0xff99fb98</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0xd</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p><strong>Note:</strong> The last 4 values are the ones we pushed on stack.
What is the first one?</p><p><strong>Answer:</strong> It is the old EBP we push at the start of the function.</p></blockquote><p>For convenience, here&#x27;s the contents of the file.
To play around with it, download the lab locally.</p><div class="language-assembly codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-assembly codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">%include &quot;printf32.asm&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">section .text</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">extern printf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">global main</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">main:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    push ebp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mov ebp, esp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    push dword 10</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    push dword 11</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    push dword 12</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    push dword 13</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mov eax, ebp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">print_stack:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    PRINTF32 `0x\x0`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    PRINTF32 `%x\x0`, eax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    PRINTF32 `: 0x\x0`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    PRINTF32 `%x\n\x0`, [eax]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sub eax, 4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cmp eax, esp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    jge print_stack</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    xor eax, eax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    leave</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ret</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/hardware-software-interface/Labs/lab7"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Lab 7 - Structures, Vectors and Strings</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/hardware-software-interface/Labs/lab9"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Lab 9 - Functions</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#task-max" class="table-of-contents__link toc-highlight">Task: Max</a></li><li><a href="#task-reverse-array" class="table-of-contents__link toc-highlight">Task: Reverse Array</a></li><li><a href="#task-stack-addressing" class="table-of-contents__link toc-highlight">Task: Stack Addressing</a></li><li><a href="#task-local-var" class="table-of-contents__link toc-highlight">Task: Local Var</a></li><li><a href="#task-gcd---greatest-common-divisor" class="table-of-contents__link toc-highlight">Task: GCD - Greatest Common Divisor</a></li><li><a href="#introduction-to-the-stack" class="table-of-contents__link toc-highlight">Introduction to the Stack</a><ul><li><a href="#reminder-stack-data-structure" class="table-of-contents__link toc-highlight">Reminder: Stack Data Structure</a></li><li><a href="#so-why-is-it-useful" class="table-of-contents__link toc-highlight">So, Why is it Useful?</a></li><li><a href="#stack-operations" class="table-of-contents__link toc-highlight">Stack Operations</a></li><li><a href="#stack-in-the-context-of-a-processs-address-space" class="table-of-contents__link toc-highlight">Stack in the Context of a Process&#39;s Address Space</a></li><li><a href="#tricks-and-tips" class="table-of-contents__link toc-highlight">Tricks and Tips</a></li></ul></li><li><a href="#guide-stack-operations" class="table-of-contents__link toc-highlight">Guide: Stack Operations</a></li><li><a href="#guide-stack-addressing" class="table-of-contents__link toc-highlight">Guide: Stack Addressing</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://curs.upb.ro" target="_blank" rel="noopener noreferrer" class="footer__link-item">Main site<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://ocw.cs.pub.ro/courses/pclp2" target="_blank" rel="noopener noreferrer" class="footer__link-item">OCW<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.facebook.com/10c1a" target="_blank" rel="noopener noreferrer" class="footer__link-item">Facebook<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 OpenEdu Team</div></div></div></footer></div>
<script src="/hardware-software-interface/assets/js/runtime~main.dfa37bb3.js"></script>
<script src="/hardware-software-interface/assets/js/main.5804b916.js"></script>
</body>
</html>